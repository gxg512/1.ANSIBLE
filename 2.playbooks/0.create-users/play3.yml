---
- name: add new users and group
  hosts: clients
  become: yes
  vars:
    user_name: "test_user"
    group_name: "test_group"
    mypassword: "pass"
    mypassword_encrypted: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      35616165313139313132383938373866643331616633346663336139353033386630643463643030
      3333393166373633346633623537666561383835646633300a316131663435393232336563313630
      31383961376239353061613464623263396164313335323464313166303765646666376465323536
      3434656535373932360a333237393236336362313934346339396334663066643631363435663836
      32643737326137613162626532373737616565363437356161633261363331363239633233623263
      3830346136613264306630343135666435393836643165373964

  tasks:
    # - name: add users and change pass
    # ansible.builtin.user:
    #  name: "{{ user_name }}"
    #  state: present
    #  groups: "{{ group_name }}"
    #  password: "{{ mypassword | password_hash('sha512') }}"

  - name: change password vault version
    ansible.builtin.user:
      name: "{{ user_name }}"
      state: present
      groups: "{{ group_name }}"
      password: "{{ 'mypassword_encrypted' | string | password_hash('sha512') }}"

